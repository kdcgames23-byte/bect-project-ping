export const API_URL="https://bect-project.onrender.com/api";export let user=JSON.parse(localStorage.getItem("bect_user"));let btnLogin=document.getElementById("btn-login"),btnRegister=document.getElementById("btn-register"),btnLogout=document.getElementById("btn-logout"),btnPublish=document.getElementById("btn-publish"),btnAdmin=document.getElementById("btn-admin"),btnSettings=document.getElementById("btn-settings"),usernameDisplay=document.getElementById("username-display"),userInfo=document.getElementById("user-info");export function updateHeader(){user=JSON.parse(localStorage.getItem("bect_user")),user?(btnLogin&&(btnLogin.style.display="none"),btnRegister&&(btnRegister.style.display="none"),btnPublish&&(btnPublish.style.display="inline"),userInfo&&(userInfo.style.display="inline-flex"),btnSettings&&(btnSettings.style.display="inline"),usernameDisplay&&(usernameDisplay.textContent=user.username,usernameDisplay.onclick=()=>window.location.href=`utilisateur.html?username=${user.username}`),btnAdmin&&("admin"===user.role?(btnAdmin.style.display="inline",btnAdmin.textContent="Admin Panel",btnAdmin.onclick=()=>window.location.href="admin.html"):(btnAdmin.style.display="inline",btnAdmin.textContent="Activer Admin",btnAdmin.onclick=activateAdminMode))):(btnLogin&&(btnLogin.style.display="inline"),btnRegister&&(btnRegister.style.display="inline"),btnPublish&&(btnPublish.style.display="none"),btnAdmin&&(btnAdmin.style.display="none"),btnSettings&&(btnSettings.style.display="none"),userInfo&&(userInfo.style.display="none"))}async function activateAdminMode(){if(!user||!user.token){alert("Vous devez \xeatre connect\xe9 pour activer le mode Admin.");return}let e=prompt("Entrez la cl\xe9 ADMIN :");if(e)try{let t=await fetch(`${API_URL}/become-admin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${user.token}`},body:JSON.stringify({key:e})}),n=t.headers.get("content-type");if(!n||!n.includes("json"))throw Error(`Erreur serveur (${t.status} ${t.statusText}). Le serveur n'a pas renvoy\xe9 de JSON.`);let i=await t.json();i.success?(alert("✅ Mode Admin activ\xe9 !"),user.role="admin",user.token=i.token,localStorage.setItem("bect_user",JSON.stringify(user)),window.location.href="admin.html"):alert("❌ "+(i.message||"Erreur de validation de la cl\xe9."))}catch(s){console.error("Erreur dans activateAdminMode:",s),alert(`Erreur de connexion serveur : ${s.message}`)}}btnLogout&&btnLogout.addEventListener("click",()=>{localStorage.removeItem("bect_user"),window.location.href="index.html"}),btnLogin&&(btnLogin.onclick=()=>window.location.href="connexion.html"),btnRegister&&(btnRegister.onclick=()=>window.location.href="inscription.html"),btnPublish&&(btnPublish.onclick=()=>window.location.href="publier.html"),btnSettings&&(btnSettings.onclick=()=>window.location.href="parametres.html"),document.addEventListener("DOMContentLoaded",updateHeader);