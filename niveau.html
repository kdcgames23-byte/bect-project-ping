<!doctype html><html lang=fr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>BECT - Niveau</title><link rel=stylesheet href=style.css><style>#level-container{max-width:1000px;margin:40px auto;padding:40px;background:#1f1f1f;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.5);color:#f0f0f0}#level-title{color:orange;font-size:2.5em;margin-bottom:5px;border-bottom:2px solid #333;padding-bottom:10px}#level-creator{font-size:1.1em;margin-bottom:10px;color:#ccc}#level-date-published{font-size:.9em;color:#777;margin-bottom:15px}#level-downloads-info{font-size:1.1em;margin-bottom:20px;color:#00d0ff;font-weight:700}#level-description{font-size:1.1em;margin-bottom:30px;padding:15px;background:#2a2a2a;border-left:5px solid orange;border-radius:5px}#level-images{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:30px}#level-images img{width:100%;height:200px;object-fit:cover;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.3);transition:transform .3s ease}#level-images img:hover{transform:scale(1.02)}#btn-download-json{width:100%;padding:15px;font-size:1.2em;background:#0078ff;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:background .3s ease}#btn-download-json:hover{background:#0059c9}#btn-back{padding:10px 15px;font-size:1em;background:#555;color:#fff;border:none;border-radius:6px;cursor:pointer;margin-bottom:20px;transition:background .3s ease}#btn-back:hover{background:#777}</style></head><body><header><div id=user-info style=display:none><span id=username-display style=cursor:pointer></span><button id=btn-settings style=display:none>Paramètres</button><button id=btn-logout>Déconnexion</button></div><div><button id=btn-login>Connexion</button><button id=btn-register>Inscription</button><button id=btn-publish style=display:none>Publier</button><button id=btn-admin style=display:none>Admin</button></div></header><main>
<button id=btn-back>← Retour</button>
<div id=level-container><h1 id=level-title>Chargement...</h1><p id=level-creator></p>
<p id=level-date-published></p>
<p id=level-downloads-info>Téléchargements : <span id=downloads-count>...</span></p>
<p id=level-description></p><h2>Galerie d'Images</h2><div id=level-images></div><button id=btn-download-json>Télécharger Fichier JSON</button></div></main><script type=module src=script.js></script><script type=module>import{API_URL,updateHeader}from"./script.js";async function incrementDownloadCounter(e){try{await fetch(`${API_URL}/levels/${e}/download`,{method:"POST",headers:{"Content-Type":"application/json"}});const t=document.getElementById("downloads-count"),n=parseInt(t.textContent)||0;t.textContent=n+1}catch(e){console.error("Erreur lors de l'incrémentation du téléchargement:",e)}}async function loadLevel(){updateHeader();const e=new URLSearchParams(window.location.search).get("id"),t=document.getElementById("btn-download-json");if(document.getElementById("btn-back").addEventListener("click",(()=>{window.history.back()})),!e)return document.getElementById("level-title").textContent="Niveau introuvable.";try{const n=await fetch(`${API_URL}/levels/${e}`);if(!n.ok){if(404===n.status)return document.getElementById("level-title").textContent="Niveau introuvable (ID inconnu).";throw new Error(`Erreur HTTP: ${n.status}`)}const o=(await n.json()).level;if(!o)return document.getElementById("level-title").textContent="Niveau introuvable.";document.getElementById("level-title").textContent=o.title,document.getElementById("downloads-count").textContent=o.downloads||0;const r=document.getElementById("level-creator");r.innerHTML=`Créé par : <span class="creator-name">${o.creator}</span>`,r.querySelector(".creator-name").addEventListener("click",(()=>{window.location.href=`utilisateur.html?username=${encodeURIComponent(o.creator)}`}));const l=document.getElementById("level-date-published");if(o.createdAt){const e={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};l.textContent=`Publié le : ${new Date(o.createdAt).toLocaleDateString("fr-FR",e)}`}else l.textContent="Publié le : Inconnu";document.getElementById("level-description").textContent=o.description||"Aucune description fournie.";const c=document.getElementById("level-images");c.innerHTML="",o.images&&o.images.length>0?(o.images||[]).forEach((e=>{const t=document.createElement("img");t.src=e,t.alt=`Capture d'écran de ${o.title}`,t.onerror=()=>t.src="https://via.placeholder.com/280x200?text=Image+introuvable",c.appendChild(t)})):c.innerHTML="<p style='color:#777; font-style:italic;'>Aucune image fournie pour ce niveau.</p>",t.onclick=async()=>{if(!o.jsonUrl)return alert("Fichier JSON non trouvé.");incrementDownloadCounter(e);try{const e=await fetch(o.jsonUrl);if(!e.ok)throw new Error(`Erreur lors du téléchargement: ${e.status}`);const t=await e.blob(),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`${o.title}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(e){console.error("Download error:",e),alert("Erreur lors du téléchargement du fichier.")}}}catch(e){console.error(e),document.getElementById("level-title").textContent="Erreur de connexion au serveur."}}loadLevel()</script></body></html>